(window.webpackJsonp=window.webpackJsonp||[]).push([[9],{"6KHS":function(o,n,t){"use strict";t.r(n),t.d(n,"BookPageModule",function(){return w});var i=t("ofXK"),e=t("3Pt+"),c=t("TEn/"),a=t("tyNb"),r=t("fXoL"),b=t("PfyA"),p=t("F7eh"),g=["audioPlayer"];function u(o,n){if(1&o&&(r.Mb(0,"ion-title"),r.ic(1),r.Lb()),2&o){var t=r.Wb();r.zb(1),r.jc(t.book.title)}}function s(o,n){1&o&&(r.Mb(0,"div",10),r.Kb(1,"ion-spinner",1),r.Lb())}function d(o,n){if(1&o&&(r.Mb(0,"div",11),r.Mb(1,"div",12),r.Kb(2,"img",13),r.Lb(),r.Mb(3,"div",14),r.ic(4),r.Lb(),r.Lb()),2&o){var t=r.Wb();r.zb(2),r.Zb("src",t.book.cover_image,r.fc),r.zb(2),r.kc(" ",t.book.blurb," ")}}function l(o,n){if(1&o){var t=r.Nb();r.Mb(0,"div",28),r.Ub("click",function(){r.ec(t);var o=r.Wb(2).$implicit;return r.Wb(2).openTip(o.tip)}),r.ic(1," Tap here! "),r.Lb()}if(2&o){var i=r.Wb(2).$implicit,e=r.Wb(2);r.Zb("ngStyle",e.getTipPosition(i.tip_position))}}function f(o,n){if(1&o){var t=r.Nb();r.Mb(0,"ion-icon",29),r.Ub("click",function(){return r.ec(t),r.Wb(4).playAudio()}),r.Lb()}}function _(o,n){if(1&o){var t=r.Nb();r.Mb(0,"ion-icon",30),r.Ub("click",function(){return r.ec(t),r.Wb(4).pauseAudio()}),r.Lb()}}function k(o,n){if(1&o){var t=r.Nb();r.Mb(0,"ion-button",31),r.Ub("click",function(){return r.ec(t),r.Wb(4).previousPage()}),r.Kb(1,"ion-icon",32),r.ic(2," \xa0\xa0Previous Page "),r.Lb()}if(2&o){var i=r.Wb(4);r.Zb("disabled",i.audioPlaying)}}function h(o,n){if(1&o){var t=r.Nb();r.Mb(0,"ion-button",31),r.Ub("click",function(){return r.ec(t),r.Wb(4).nextPage()}),r.ic(1," Next Page\xa0\xa0 "),r.Kb(2,"ion-icon",33),r.Lb()}if(2&o){var i=r.Wb(4);r.Zb("disabled",i.audioPlaying)}}function v(o,n){if(1&o){var t=r.Nb();r.Mb(0,"ion-button",31),r.Ub("click",function(){return r.ec(t),r.Wb(4).closeBook()}),r.ic(1," Close Book "),r.Lb()}if(2&o){var i=r.Wb(4);r.Zb("disabled",i.audioPlaying)}}function m(o,n){if(1&o&&(r.Mb(0,"div",17),r.Mb(1,"div",18),r.Kb(2,"img",13),r.hc(3,l,2,1,"div",19),r.Lb(),r.Mb(4,"div",20),r.Mb(5,"p",21),r.ic(6),r.Lb(),r.Mb(7,"p",22),r.ic(8),r.Lb(),r.Lb(),r.Mb(9,"div",23),r.hc(10,f,1,0,"ion-icon",24),r.hc(11,_,1,0,"ion-icon",25),r.Lb(),r.Mb(12,"div",26),r.hc(13,k,3,1,"ion-button",27),r.hc(14,h,3,1,"ion-button",27),r.hc(15,v,2,1,"ion-button",27),r.Lb(),r.Lb()),2&o){var t=r.Wb().$implicit,i=r.Wb(2);r.zb(2),r.Zb("src",t.image,r.fc),r.zb(1),r.Zb("ngIf",t.tip),r.zb(3),r.jc(t.maori_text),r.zb(2),r.jc(t.english_text),r.zb(2),r.Zb("ngIf",!i.audioPlaying),r.zb(1),r.Zb("ngIf",i.audioPlaying),r.zb(2),r.Zb("ngIf",i.currentPage>0),r.zb(1),r.Zb("ngIf",i.currentPage<i.book.pages.length-1),r.zb(1),r.Zb("ngIf",i.currentPage>=i.book.pages.length-1)}}function M(o,n){if(1&o&&(r.Mb(0,"div"),r.hc(1,m,16,9,"div",16),r.Lb()),2&o){var t=n.index,i=r.Wb(2);r.zb(1),r.Zb("ngIf",i.currentPage===t)}}function P(o,n){if(1&o&&(r.Mb(0,"div"),r.hc(1,M,2,1,"div",15),r.Lb()),2&o){var t=r.Wb();r.zb(1),r.Zb("ngForOf",t.book.pages)}}function y(o,n){if(1&o&&(r.Mb(0,"audio",35),r.Kb(1,"source",36),r.Lb()),2&o){var t=n.$implicit;r.ac("id","pageaudio",n.index,""),r.zb(1),r.Zb("src",t.audio,r.fc)}}function C(o,n){if(1&o&&(r.Mb(0,"div"),r.hc(1,y,2,2,"audio",34),r.Lb()),2&o){var t=r.Wb();r.zb(1),r.Zb("ngForOf",t.book.pages)}}function O(o,n){if(1&o){var t=r.Nb();r.Mb(0,"ion-button",39),r.Ub("click",function(){return r.ec(t),r.Wb(2).startReading()}),r.ic(1," Start Reading\xa0\xa0 "),r.Kb(2,"ion-icon",33),r.Lb()}}function x(o,n){if(1&o){var t=r.Nb();r.Mb(0,"ion-button",39),r.Ub("click",function(){return r.ec(t),r.Wb(2).buy()}),r.ic(1," Unlock for"),r.Mb(2,"span",40),r.ic(3,"$5.00"),r.Lb(),r.ic(4,"\xa0\xa0 "),r.Kb(5,"ion-icon",41),r.Lb()}}function I(o,n){if(1&o&&(r.Mb(0,"ion-footer",37),r.hc(1,O,3,0,"ion-button",38),r.hc(2,x,6,0,"ion-button",38),r.Lb()),2&o){var t=r.Wb();r.zb(1),r.Zb("ngIf",!t.book.started&&t.book.purchased),r.zb(1),r.Zb("ngIf",!t.book.started&&!t.book.purchased)}}var L=function(o){return{"transparent-header":o}},z=[{path:"",component:function(){function o(o,n,t,i,e,c,a,r){var b=this;this.bookService=o,this.route=n,this.alertCtrl=t,this.location=i,this.platform=e,this.iap=c,this.loadingController=a,this.alertController=r,this.loading=!0,this.book={id:this.route.snapshot.params.id,pages:[]},this.getBook(),this.productId="com.healthandsafetystoriesnz.app.book",this.product={price:5,title:"Unlock",productId:this.productId},this.iap.getProducts([this.productId]).then(function(o){for(var n in o)b.product=o[n],b.product.price&&(document.getElementById("product-price").innerText=b.product.price)}).catch(function(o){})}return o.prototype.ngOnInit=function(){},o.prototype.getBook=function(){var o=this;this.bookService.getBook(this.book.id).then(function(n){console.log(n),o.book=n,o.loading=!1}).catch(function(){o.loading=!1})},o.prototype.buy=function(){var o=this;this.alertController.create({header:"Thank You!",subHeader:"This story has now been unlocked.",message:"You will now be able to open and read it in the app. If you have any issues, contact support under Settings in the app.",buttons:[{text:"OK",role:"cancel"}]}).then(function(o){o.present(),o.onDidDismiss().then(function(){})}),this.book.purchased=!0,this.bookService.purchaseBook(this.book.id).then(function(){o.getBook()})},o.prototype.startReading=function(){this.currentPage=0,this.platform.is("ios")||this.playAudio(),this.book.started=!0},o.prototype.nextPage=function(){this.currentPage+=1,this.platform.is("ios")||this.playAudio()},o.prototype.previousPage=function(){this.currentPage-=1},o.prototype.playAudio=function(){var o=this,n=document.getElementById("pageaudio"+this.currentPage);n.play(),this.audioPlaying=!0,n.addEventListener("ended",function(){o.audioPlaying=!1})},o.prototype.pauseAudio=function(){document.getElementById("pageaudio"+this.currentPage).pause(),this.audioPlaying=!1},o.prototype.getTipPosition=function(o){var n=o.split(",");return{top:n[0]+"%",left:n[1]+"%"}},o.prototype.openTip=function(o){this.alertCtrl.create({header:"Tip",message:o,buttons:[{text:"Close",role:"cancel",handler:function(o){}}]}).then(function(o){o.present()})},o.prototype.closeBook=function(){this.location.back()},o.\u0275fac=function(n){return new(n||o)(r.Jb(b.a),r.Jb(a.a),r.Jb(c.a),r.Jb(i.f),r.Jb(c.w),r.Jb(p.a),r.Jb(c.v),r.Jb(c.a))},o.\u0275cmp=r.Db({type:o,selectors:[["app-book"]],viewQuery:function(o,n){var t;1&o&&r.lc(g,1),2&o&&r.dc(t=r.Vb())&&(n.audio=t.first)},decls:12,vars:10,consts:[[3,"ngClass"],["color","primary"],[4,"ngIf"],["slot","start"],[3,"color"],["defaultHref","/home"],[1,"book"],["class","book__loading",4,"ngIf"],["class","book__cover",4,"ngIf"],["class","book-footer",4,"ngIf"],[1,"book__loading"],[1,"book__cover"],[1,"book__cover__image"],[3,"src"],[1,"book__cover__blurb"],[4,"ngFor","ngForOf"],["class","book__page",4,"ngIf"],[1,"book__page"],[1,"book__page__image"],["class","book__page__image__tip",3,"ngStyle","click",4,"ngIf"],[1,"book__page__text"],[1,"book__page__maori"],[1,"book__page__english"],[1,"book__page__audio"],["color","primary","name","play",3,"click",4,"ngIf"],["color","primary","name","pause",3,"click",4,"ngIf"],[1,"book__page__navigation"],["color","primary",3,"disabled","click",4,"ngIf"],[1,"book__page__image__tip",3,"ngStyle","click"],["color","primary","name","play",3,"click"],["color","primary","name","pause",3,"click"],["color","primary",3,"disabled","click"],["name","arrow-back"],["name","arrow-forward"],[3,"id",4,"ngFor","ngForOf"],[3,"id"],["type","audio/mpeg",3,"src"],[1,"book-footer"],["color","primary","expand","full","class","book-footer__button",3,"click",4,"ngIf"],["color","primary","expand","full",1,"book-footer__button",3,"click"],["id","product-price"],["name","lock-closed"]],template:function(o,n){1&o&&(r.Mb(0,"ion-header",0),r.Mb(1,"ion-toolbar",1),r.hc(2,u,2,1,"ion-title",2),r.Mb(3,"ion-buttons",3),r.Mb(4,"ion-button",4),r.Kb(5,"ion-back-button",5),r.Lb(),r.Lb(),r.Lb(),r.Lb(),r.Mb(6,"ion-content",6),r.hc(7,s,2,0,"div",7),r.hc(8,d,5,2,"div",8),r.hc(9,P,2,1,"div",2),r.hc(10,C,2,1,"div",2),r.Lb(),r.hc(11,I,3,2,"ion-footer",9)),2&o&&(r.Zb("ngClass",r.cc(8,L,n.book.started)),r.zb(2),r.Zb("ngIf",!n.book.started),r.zb(2),r.Zb("color",n.book.started?"primary":"light"),r.zb(3),r.Zb("ngIf",n.loading),r.zb(1),r.Zb("ngIf",!n.book.started),r.zb(1),r.Zb("ngIf",n.book.started),r.zb(1),r.Zb("ngIf",!n.loading&&n.book.pages.length>0),r.zb(1),r.Zb("ngIf",!n.loading))},directives:[c.j,i.h,c.s,i.j,c.g,c.f,c.d,c.e,c.h,c.r,c.q,i.i,i.k,c.k,c.i],styles:[".transparent-header[_ngcontent-%COMP%]{position:absolute;top:0;left:0;width:100%}.transparent-header[_ngcontent-%COMP%]   ion-toolbar[_ngcontent-%COMP%]{--ion-color-base:transparent!important}.transparent-header.header-ios[_ngcontent-%COMP%]   ion-toolbar[_ngcontent-%COMP%]:last-child{--border-width:0 0 0px}.transparent-header[_ngcontent-%COMP%]:after{background:none}.book[_ngcontent-%COMP%]   .book__loading[_ngcontent-%COMP%]{text-align:center;margin-top:60px}.book[_ngcontent-%COMP%]   .book__cover[_ngcontent-%COMP%]{padding:0 20px}.book[_ngcontent-%COMP%]   .book__cover[_ngcontent-%COMP%]   .book__cover__image[_ngcontent-%COMP%]{margin-top:20px}.book[_ngcontent-%COMP%]   .book__cover[_ngcontent-%COMP%]   .book__cover__blurb[_ngcontent-%COMP%]{margin-top:10px;margin-bottom:40px;text-align:center}.book[_ngcontent-%COMP%]   .book__page__text[_ngcontent-%COMP%]{padding:10px 20px 0;position:relative;text-align:center}.book[_ngcontent-%COMP%]   .book__page__image[_ngcontent-%COMP%]{width:100%;position:relative}.book[_ngcontent-%COMP%]   .book__page__image[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:100%}.book[_ngcontent-%COMP%]   .book__page__image__tip[_ngcontent-%COMP%]{position:absolute;background-color:#329cce;color:#fff;font-size:12px;line-height:60px;width:60px;height:60px;text-align:center;border-radius:30px;opacity:.9}.book[_ngcontent-%COMP%]   .book__page__audio[_ngcontent-%COMP%]{margin-top:20px;text-align:center}.book[_ngcontent-%COMP%]   .book__page__audio[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:30px}.book[_ngcontent-%COMP%]   .book__page__navigation[_ngcontent-%COMP%]{text-align:center;margin-top:30px;margin-bottom:30px}#product-price[_ngcontent-%COMP%]{margin-left:5px}"]}),o}()}],Z=function(){function o(){}return o.\u0275fac=function(n){return new(n||o)},o.\u0275mod=r.Hb({type:o}),o.\u0275inj=r.Gb({imports:[[a.i.forChild(z)],a.i]}),o}(),w=function(){function o(){}return o.\u0275fac=function(n){return new(n||o)},o.\u0275mod=r.Hb({type:o}),o.\u0275inj=r.Gb({imports:[[i.b,e.a,c.t,Z]]}),o}()}}]);